# Конфигурация с локальной зоной

## Назначение

Настроить два сервера PowerDNS
* обычный
* имеющий для заданной зоны локальную версию некоторых записей

При этом записи, которые одинаковы для обеих зон, не должны дублироваться.

## Описание

* Создаем отдельного пользователя `LOCAL_PGUSER` и одноименную схему БД, в которой
  * Таблица `records_local` содержит записи, которые надо добавить/заменить в исходной зоне
  * Представление `records` возвращает `LOCAL_PGUSER` актуальный список записей зоны

## Деплой

Выполняется после развертывания PowerDNS и настройки его работы с зоной из `domain.sql`.

1. Задаем в `.env` значения `LOCAL_PGUSER`, `LOCAL_PGPASSWORD`
2. Создаем в БД объекты - `make local-init`
3. Раскомментируем и заполняем в `domain.sql` блок `** local zone records **`
4. Разворачиваем вторую копию PowerDNS, передав в настройках параметры из п.1

